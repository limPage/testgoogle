<!DOCTYPE html>
<html>
<head>
  <title>Google 로그인 + 이름 저장</title>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
  <h2>Google 로그인 후 이름을 입력해보세요</h2>
  <button onclick="handleAuthClick()">Google 로그인</button>

  <div id="login-info" style="display:none; margin-top:20px;">
    <p id="user-email"></p>
    <input type="text" id="name" placeholder="이름 입력" />
    <button onclick="saveName()">Google Drive에 저장</button>
    <p id="result"></p>
  </div>

<script>
  const CLIENT_ID = '504615460563-i0mbebb61nkj5h2k1gafpqvti54qangl.apps.googleusercontent.com';
  const SCOPES = 'https://www.googleapis.com/auth/drive.file';
  let accessToken = null;

  function handleAuthClick() {
    gapi.load('client:auth2', () => {
      gapi.auth2.init({ client_id: CLIENT_ID, scope: SCOPES }).then(() => {
        gapi.auth2.getAuthInstance().signIn().then(user => {
          const profile = user.getBasicProfile();
          accessToken = user.getAuthResponse().access_token;

          document.getElementById('user-email').innerText = `로그인됨: ${profile.getEmail()}`;
          document.getElementById('login-info').style.display = 'block';
        });
      });
    });
  }

  function saveName() {
    const name = document.getElementById("name").value;
    const fileContent = JSON.stringify({ name });

    const metadata = {
      name: "user_name.json",
      mimeType: "application/json"
    };

    const form = new FormData();
    form.append("metadata", new Blob([JSON.stringify(metadata)], { type: "application/json" }));
    form.append("file", new Blob([fileContent], { type: "application/json" }));

    fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart", {
      method: "POST",
      headers: new Headers({
        Authorization: "Bearer " + accessToken
      }),
      body: form
    })
    .then(res => res.json())
    .then(data => {
      console.log("Drive 응답:", data);
      if (data.id) {
        document.getElementById("result").innerText = "✅ 저장 성공! 파일 ID: " + data.id;
      } else {
        document.getElementById("result").innerText = "⚠️ 저장 실패: " + JSON.stringify(data);
      }
    })
    .catch(err => {
      console.error("에러:", err);
      document.getElementById("result").innerText = "❌ 에러 발생: " + err.message;
    });
  }
</script>
</body>
</html>
